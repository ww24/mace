/*!
 * Mace 0.1.2
 * copyright: Takenori Nakagawa
 * license: MIT
 */
(function(){"use strict";var e;e=function(){function e(e,t,n){var r;this.editor=e,this.preview=null!=t?t:null,null==n&&(n={}),r=this,this.Ace={Range:ace.require("ace/range").Range},this.ace=ace.edit(this.editor),this.ace.getSession().setMode("ace/mode/markdown"),this.ace.setTheme("ace/theme/monokai"),marked.setOptions({renderer:new marked.Renderer,gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1}),null!==this.preview&&(this._render(),this.ace.on("change",function(e){return function(){return e._render()}}(this))),Object.defineProperty(this,"value",{get:function(){return this.ace.getValue()}}),Object.defineProperty(this,"font_size",{get:function(){return this.ace.getFontSize()},set:function(e){return this.ace.setFontSize(e)}})}return e.prototype._render=function(){var e;return e=this.ace.getValue(),marked(e,function(e){return function(t,n){return null!=t&&console.error(t),e.preview.innerHTML=n}}(this))},e.prototype._getCurrentRage=function(){var e;return e=this.ace.selection.getRange(),this.ace.selection.clearSelection(),0===e.end.column&&e.end.row-e.start.row===1&&e.end.row--,e},e.prototype.indent=function(e){var t,n;for(null==e&&(e=1),t=n=0;e>=0?e>n:n>e;t=e>=0?++n:--n)this.ace.indent();return this.ace.focus()},e.prototype.outdent=function(e){var t,n;for(null==e&&(e=1),t=n=0;e>=0?e>n:n>e;t=e>=0?++n:--n)this.ace.blockOutdent();return this.ace.focus()},e.prototype.heading=function(e){var t,n,r,i,o,s,a,c,u,h,l;if(null==e&&(e=1),0>e||e>6)throw new RangeError;for(r=this.ace.getCursorPosition(),i=this._getCurrentRage(),o=a=u=i.start.row,h=i.end.row;h>=u?h>=a:a>=h;o=h>=u?++a:--a)if(this.ace.moveCursorTo(o,0),s=this.getLineText(o),t=(null!=(l=s.match(/^#+/i))?l[0].length:void 0)||0,t!==e)for(n=c=t;e>=t?e>c:c>e;n=e>=t?++c:--c)e>t?this.ace.insert("#"):this.ace.remove("right");return this.ace.moveCursorTo(r.row,r.column+e-t),this.ace.focus()},e.prototype.link=function(e,t,n,r){var i,o;return null==e&&(e="./"),null==n&&(n=""),null==r&&(r=!1),o=this.ace.getCopyText().split("\n").join(""),t=t||o||"link",n.length>0&&(n=' "'+n+'"'),i=["","!"][+r],this.ace.insert(""+i+"["+t+"]("+e+n+")"),this.ace.focus()},e.prototype.italic=function(e,t){var n;return null==e&&(e="*"),null==t&&(t="italic"),n=this.ace.getCopyText().split("\n").join(""),t=n||t,this.ace.insert(""+e+t+e),this.ace.focus()},e.prototype.bold=function(e,t){return null==e&&(e="*"),null==t&&(t="bold"),this.italic(e+e,t)},e.prototype.line=function(e){var t;return null==e&&(e="*"),t=this.ace.getCursorPosition(),t.column>0&&this.ace.insert("\n"),this.ace.insert("\n"+e+e+e+"\n")},e.prototype.getLineText=function(e){var t,n,r;return n=this.ace.getCursorPosition(),e=e||n.row,this.ace.moveCursorTo(e,0),this.ace.navigateLineEnd(),t=this.ace.getCursorPosition(),this.ace.selection.addRange(new this.Ace.Range(t.row,0,t.row,t.column)),r=this.ace.getCopyText(),this.ace.selection.clearSelection(),this.ace.moveCursorTo(n.row,n.column),r},e.prototype.list=function(e,t){var n,r,i,o,s,a,c,u,h,l,g,d;if(null==e&&(e="-"),null==t&&(t=[]),o=this.ace.getCursorPosition(),s=this._getCurrentRage(),s.start.row===s.end.row&&t.length>0)u=isNaN(e)?function(t){return""+e+" "+t}:function(t){return""+e++ +". "+t},this.ace.insert(t.map(u).join("\n")+"\n");else for(a=l=g=s.start.row,d=s.end.row;d>=g?d>=l:l>=d;a=d>=g?++l:--l)this.ace.moveCursorTo(a,0),h=this.getLineText(a),i=h.match(/^(\s*)([*-]|[0-9]\.)(\s*)[^]+/),r=null!==i,r?(n=null!=i?i[1].length:void 0,this.ace.moveCursorTo(a,n),c=null!=i?i[2].length:void 0,this.ace.selection.addRange(new this.Ace.Range(a,0,a,c+1)),this.ace.remove("right")):this.ace.insert(isNaN(e)?""+e+" ":""+e++ +". ");return this.ace.moveCursorTo(o.row,o.column+2),this.ace.focus()},e.prototype.code=function(e,t){var n,r,i,o;return null==e&&(e=""),null==t&&(t=""),r=this.ace.getCursorPosition(),o=this.ace.getCopyText(),~o.indexOf("\n")?(i=this._getCurrentRage(),n=1,this.ace.moveCursorTo(i.start.row,i.start.column),this.ace.insert("```"+t+"\n"),this.ace.moveCursorTo(i.end.row+n,i.end.column),0!==i.end.column&&(this.ace.insert("\n"),n++),this.ace.insert("```\n"),this.ace.moveCursorTo(i.end.row+n+1,0)):(o=o.split("\n").join(""),o?(this.ace.remove("right"),this.ace.insert("`"+o+"`")):(this.ace.insert("```"+t+"\n"+e+"\n```\n"),e?this.ace.moveCursorTo(r.row+e.split("\n").length+3,0):this.ace.moveCursorTo(r.row+1,0))),this.ace.focus()},e.prototype.clear=function(e){return null==e&&(e=!1),e?this.ace.setValue(""):this.ace.removeLines()},e.prototype.quote=function(e){var t,n,r,i,o,s,a,c,u,h,l;if(null==e&&(e=""),i=this.ace.getCursorPosition(),o=this._getCurrentRage(),o.start.row===o.end.row&&e.length>0)this.ace.insert(e.split("\n").map(function(e){return"> "+e}).join("\n")+"\n");else for(s=u=h=o.start.row,l=o.end.row;l>=h?l>=u:u>=l;s=l>=h?++u:--u)this.ace.moveCursorTo(s,0),c=this.getLineText(s),r=c.match(/^(\s*)>(\s*)[^]*/),n=null!==r,n?(t=null!=r?r[1].length:void 0,this.ace.moveCursorTo(s,t),a=null!=r?r[2].length:void 0,this.ace.selection.addRange(new this.Ace.Range(s,t,s,a+1)),this.ace.remove("right")):this.ace.insert("> ");return this.ace.moveCursorTo(i.row,i.column+2),this.ace.focus()},e}(),this.Mace=e}).call(this);